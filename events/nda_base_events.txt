namespace = nda_base

nda_base.1 = { # An Introduction to NDA
	type = country_event
	placement = ROOT
	title = nda_base.1.t
	desc = nda_base.1.d
	flavor =  nda_base.1.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = {

	}

	immediate = {

	}	
	
	option = { #So it begins
		name = nda_base.1.a
		default_option = yes
		}
}

nda_base.2 = { # Nameless Cults published
	type = country_event
	placement = ROOT
	title = nda_base.2.t
	desc = nda_base.2.d
	flavor =  nda_base.2.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
 		# 1839 and owner of dusseldorf
		game_date >= 1839 #1837 
		owns_entire_state_region = STATE_NORTH_RHINE

		NOT = {has_global_variable = nda_nameless_cults_exists}
	}

	immediate = {
		set_global_variable = nda_nameless_cults_exists
	}	
	
	option = { #"What harm can a book do?"
		name = nda_base.2.a
		default_option = yes
		# annoy the clergy
		ig:ig_devout = {
			add_modifier = {
	            name = permitted_obscene_publication
	            months = 36
	        }
		}

		# the intellectuals approve
		ig:ig_intelligentsia = {
			add_modifier = {
	            name = championed_free_speech
	            months = 36
	        }
		}
		set_variable = nda_nameless_cults
	}

	option = { #"Such writings must be supressed!"
		name = nda_base.2.b

		# annoy the intelectuals
		ig:ig_intelligentsia = {
			add_modifier = {
	            name = curtailed_free_speech
	            months = 36
	        }
		}
		# the church approves
		ig:ig_devout = {
			add_modifier = {
	            name = stopped_obscene_publication
	            months = 36
	        }
		}
		set_variable = nda_nameless_cults_supressed
	}
}

nda_base.3 = { # Imprint of Nameless Cults - as above but for other major countries 
	type = country_event
	placement = ROOT
	title = nda_base.3.t
	desc = nda_base.3.d
	flavor =  nda_base.3.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
 		# 1840 and not dusseldorf
		game_date >= 1838 #1840
		has_global_variable = nda_nameless_cults_exists

		NOT = { has_variable = nda_nameless_cults}

		OR = {
			country_rank = rank_value:great_power
			country_rank = rank_value:major_power
			AND = { # Alway for New England
				exists = c:NEN
				c:NEN = ROOT
			}
		}
	}

	immediate = {
		# set_variable = nda_nameless_cults # don't set immediate as causes follow on event to trigger simultaniously.
		debug_log = "Imprint of Nameless Cults"
	}	
	
	option = { #"What harm can a book do?"
		name = nda_base.3.a
		default_option = yes
		# annoy the clergy
		ig:ig_devout = {
			add_modifier = {
	            name = permitted_obscene_publication
	            months = 36
	        }
		}

		# the intellectuals approve
		ig:ig_intelligentsia = {
			add_modifier = {
	            name = championed_free_speech
	            months = 36
	        }
		}

		set_variable = nda_nameless_cults
	}

	option = { #"Such writings must be supressed!"
		name = nda_base.3.b

		# annoy the intelectuals
		ig:ig_intelligentsia = {
			add_modifier = {
	            name = curtailed_free_speech
	            months = 36
	        }
		}
		# the church approves
		ig:ig_devout = {
			add_modifier = {
	            name = stopped_obscene_publication
	            months = 36
	        }
		}

		set_variable = nda_nameless_cults_supressed
	}
}

nda_base.4 = { # The Death of Junzt
	type = country_event
	placement = ROOT
	title = nda_base.4.t
	desc = nda_base.4.d
	flavor =  nda_base.4.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
 		# 1841 - msg to all players
		game_date >= 1841

		has_global_variable = nda_nameless_cults_exists
	}

	immediate = {
		#set_global_variable = nda_nameless_cults_junztdeath # don't need unless notifing abroad?
	}	
	
	option = { #So it begins
		name = nda_base.4.a
		default_option = yes
		}
}

# Cultist in government - mostly hidden?
nda_base.5 = { # First Cultist in Country
	type = country_event
	placement = ROOT
	title = nda_base.5.t
	desc = nda_base.5.d
	flavor =  nda_base.5.f

	duration = 3

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	gui_window = event_window_1char_tabloid

	left_icon = scope:converted_ig.leader

	trigger = {
		OR = {
			has_variable = nda_nameless_cults
			has_variable = nda_nameless_cults_supressed
		}
		
		NOT = {
			has_journal_entry = je_nda_cult_spreads
			has_variable = nda_cultists_in_open
		}
	}

	immediate = {
		# set ig leader character to be Cultist - exclude devout initially?
		random_interest_group = {
			limit = { NOT = { is_interest_group_type = ig_devout } }
			leader = { 
				add_trait = nda_cultist 
				save_scope_as = converted_ig_leader
				}
				save_scope_as = converted_ig
	
		}

		# start journal for initial cult spread
		if = {
			limit = {
				NOT = {has_journal_entry = je_nda_cult_spreads}
			}
			add_journal_entry = { type = je_nda_cult_spreads }		
		}		
	}	
	
	option = { #"What can we do"
		name = nda_base.5.a
		default_option = yes
	}
}

nda_base.6 = { # Secret Cultists in Country - only fired from journals: je_nda_cult_spreads 
	type = country_event
	placement = ROOT
	title = nda_base.6.t
	desc = nda_base.6.d
	flavor =  nda_base.6.f

	duration = 3

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"
	
	gui_window = event_window_1char_tabloid

	left_icon = scope:converted_ig.leader

	trigger = {
		#should prevent assignment if all ig already has cultist+ ?
	}

	immediate = {
		# set ig leader character to be Cultist - exclude devout initially?
		random_interest_group = {
			limit = { 
				NOT = { 
					leader = { 
						OR = { 
							has_trait = nda_cultist 
							has_trait = nda_acolyte 
							has_trait = nda_master    
							}
						}
					} 
				}
			leader = { 
				add_trait = nda_cultist 
				save_scope_as = converted_ig_leader
			}
			save_scope_as = converted_ig	
		}	
	}	
	
	option = { #"What can we do"
		name = nda_base.6.a
		default_option = yes
	}
}

nda_base.7 = { # The Cult in power - called from journal ' je_nda_cult_spreads' on completion
	type = country_event
	placement = ROOT
	title = nda_base.7.t
	desc = nda_base.7.d
	flavor =  nda_base.7.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = {

	}

	immediate = {
		set_variable = nda_cultists_in_open

		# set country to contain cultists. need better way of differetating cultist culture and religion.
		add_primary_culture = cu:nda_cul_cultist # Adding Culture allows for Leaders of Culture despite no pop present!
		# set country states as homeland, convert % of pops to religion?
		 every_scope_state = {
			state_region = {
				add_homeland = nda_cul_cultist
			}

			convert_population = { target = rel:nda_rel_cultist value = 0.05 }	
		 }
		# add new IG to country just for cultist religion ?

		# notify players of change
		save_scope_as = originator

		every_country = {
			limit = {
				is_player = yes
				NOT = { has_global_variable = nda_cultists_in_open}
			}

			post_notification = nda_first_open_cult 
			#trigger_event = { id = nda_base.8 }	

		}
		
		set_global_variable = nda_cultists_in_open	
	}	
	
	option = { #So it begins
		name = nda_base.7.a
		default_option = yes
		}
}

#nda_base.8 = { # Notification that first country has recognized cult
#	type = country_event
#	placement = ROOT
#	title = nda_base.8.t
#	desc = nda_base.8.d
#	flavor =  nda_base.8.f
#
#	duration = 3
#
#	event_image = {
#		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
#		
#	}
#	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }
#
#	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
#	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"
#
#	icon = "gfx/interface/icons/event_icons/event_fire.dds"
#
#	trigger = {
#		NOT = { has_gloabal_variable = nda_cultists_in_open}
#	}
#
#	immediate = {
#		set_gloabal_variable = nda_cultists_in_open # stop refiring
#	}	
#	
#	option = { #So it begins
#		name = nda_base.8.a
#		default_option = yes
#		}
#}
# Conjuction and Ritual events

