namespace = nda_base

nda_base.1 = { # An Introduction to NDA
	type = country_event
	placement = ROOT
	title = nda_base.1.t
	desc = nda_base.1.d
	flavor =  nda_base.1.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds" #event_fire.dds"

	trigger = {

	}

	immediate = {

	}	
	
	option = { #So it begins
		name = nda_base.1.a
		default_option = yes
		}
}

nda_base.2 = { # Nameless Cults published
	type = country_event
	placement = ROOT
	title = nda_base.2.t
	desc = nda_base.2.d
	flavor =  nda_base.2.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_politicians_arguing.bk2"
		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/tutorial_icon.dds"

	trigger = {
 		# 1839 and owner of dusseldorf
		game_date >= 1839 #1837 
		owns_entire_state_region = STATE_NORTH_RHINE

		NOT = {has_global_variable = nda_nameless_cults_exists}
	}

	immediate = {
		set_global_variable = nda_nameless_cults_exists

		# set target countries for intial YIG and DGN expansions - needed to give competition to sole potential countries
		random_country = {
			limit = {
				country_rank = rank_value:minor_power
				NOT = { has_variable = nda_nameless_cults_selected }
				any_scope_state = { 
					is_potentially_yigian = yes
				}
			}

			set_variable = nda_nameless_cults_selected
		}
		random_country = {
			limit = {
				country_rank = rank_value:minor_power
				NOT = { has_variable = nda_nameless_cults_selected }
				any_scope_state = { 
					is_potentially_yigian = yes
				}
			}

			set_variable = nda_nameless_cults_selected
		}
		random_country = {
			limit = {
				country_rank = rank_value:minor_power
				NOT = { has_variable = nda_nameless_cults_selected }
				any_scope_state = { 
					is_potentially_dagonic = yes
				}
			}

			set_variable = nda_nameless_cults_selected
		}
		random_country = {
			limit = {
				country_rank = rank_value:minor_power
				NOT = { has_variable = nda_nameless_cults_selected }
				any_scope_state = { 
					is_potentially_dagonic = yes
				}
			}

			set_variable = nda_nameless_cults_selected
		}
	}	
	
	option = { #"What harm can a book do?"
		name = nda_base.2.a
		default_option = yes
		
		ai_chance = { # will +ve effect conversion rate
			base = 80		
		}

		# annoy the clergy
		ig:ig_devout = {
			add_modifier = {
	            name = permitted_obscene_publication
	            months = 36
	        }
		}

		# the intellectuals approve
		ig:ig_intelligentsia = {
			add_modifier = {
	            name = championed_free_speech
	            months = 36
	        }
		}
		set_variable = nda_nameless_cults
	}

	option = { #"Such writings must be supressed!"
		name = nda_base.2.b

		ai_chance = { # will -ve effect conversion rate
			base = 20		
		}

		# annoy the intelectuals
		ig:ig_intelligentsia = {
			add_modifier = {
	            name = curtailed_free_speech
	            months = 36
	        }
		}
		# the church approves
		ig:ig_devout = {
			add_modifier = {
	            name = stopped_obscene_publication
	            months = 36
	        }
		}
		set_variable = nda_nameless_cults_supressed
	}
}

nda_base.3 = { # Imprint of Nameless Cults - as above but for other major countries 
	type = country_event
	placement = ROOT
	title = nda_base.3.t
	desc = nda_base.3.d
	flavor =  nda_base.3.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_politicians_arguing.bk2"
		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/tutorial_icon.dds"

	trigger = {
 		# 1840 and not dusseldorf
		game_date >= 1838 #1840
		has_global_variable = nda_nameless_cults_exists

		NOT = { has_variable = nda_nameless_cults}

		OR = { # will also fire for countries as they promote in rank
			country_rank = rank_value:great_power
			country_rank = rank_value:major_power
			AND = { # Alway for New England
				exists = c:NEN
				c:NEN = ROOT
			}

			# random countries previously selected in yigian lands to rival brazil and also in dagonic shores
			has_variable = nda_nameless_cults_selected
		}

		# redundant to spread to cult country
		NOT = {
			OR = {
				c:ELD = ROOT
				c:YIG = ROOT
				c:DGN = ROOT
			}				
		}
	}

	immediate = {
		# set_variable = nda_nameless_cults # don't set immediate as causes follow on event to trigger simultaniously.
		debug_log = "Imprint of Nameless Cults" 
	}	
	
	option = { #"What harm can a book do?"
		name = nda_base.3.a
		default_option = yes
		
		ai_chance = { # will +ve effect conversion rate
			base = 80		
		}

		# annoy the clergy
		ig:ig_devout = {
			add_modifier = {
	            name = permitted_obscene_publication
	            months = 36
	        }
		}

		# the intellectuals approve
		ig:ig_intelligentsia = {
			add_modifier = {
	            name = championed_free_speech
	            months = 36
	        }
		}

		set_variable = nda_nameless_cults
	}

	option = { #"Such writings must be supressed!"
		name = nda_base.3.b

		ai_chance = { # will -ve effect conversion rate
			base = 20		
		}

		# annoy the intelectuals
		ig:ig_intelligentsia = {
			add_modifier = {
	            name = curtailed_free_speech
	            months = 36
	        }
		}
		# the church approves
		ig:ig_devout = {
			add_modifier = {
	            name = stopped_obscene_publication
	            months = 36
	        }
		}

		set_variable = nda_nameless_cults_supressed
	}
}

nda_base.4 = { # The Death of Junzt
	type = country_event
	placement = ROOT
	title = nda_base.4.t
	desc = nda_base.4.d
	flavor =  nda_base.4.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_vandalized_storefront.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
 		# 1841 - msg to all players
		game_date >= 1841
		game_date < 1842 # Can clear variables out after this date ?
		has_global_variable = nda_nameless_cults_exists
		NOT = { has_variable = nda_nameless_cults_junztdeath  }
	}

	immediate = {
		set_variable = nda_nameless_cults_junztdeath # don't need unless notifing abroad?
	}	
	
	option = { #So it begins
		name = nda_base.4.a
		default_option = yes
	}
}

# Cultist in government - mostly hidden?
nda_base.5 = { # First Cultist in Country
	type = country_event
	placement = ROOT
	title = nda_base.5.t
	desc = nda_base.5.d
	flavor =  nda_base.5.f

	duration = 3

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	gui_window = event_window_1char_tabloid

	left_icon = scope:converted_ig.leader

	trigger = {
		OR = {
			has_variable = nda_nameless_cults
			has_variable = nda_nameless_cults_supressed
		}
		
		NOT = {
			OR = {
				has_journal_entry = je_nda_cult_spreads
				has_variable = nda_cultists_in_open		
			}

		}
	}

	immediate = {
		# set ig leader character to be Cultist - exclude devout initially?
		random_interest_group = {
			limit = { NOT = { is_interest_group_type = ig_devout } }
			leader = { 
				add_trait = nda_cultist 
				save_scope_as = converted_ig_leader
				}
				save_scope_as = converted_ig
	
		}

		# start journal for initial cult spread
		if = {
			limit = {
				NOT = {has_journal_entry = je_nda_cult_spreads}
				NOT = {has_variable = nda_cultists_in_open} # don't rerun
			}
			add_journal_entry = { type = je_nda_cult_spreads }		
		}		
	}	
	
	option = { #"What can we do"
		name = nda_base.5.a
		default_option = yes
	}
}

nda_base.6 = { # Secret Cultists in Country - only fired from journals: je_nda_cult_spreads 
	type = country_event
	placement = ROOT
	title = nda_base.6.t
	desc = nda_base.6.d
	flavor =  nda_base.6.f

	duration = 3

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"
	
	gui_window = event_window_1char_tabloid

	left_icon = scope:converted_ig.leader

	trigger = {
		#should prevent assignment if all ig already has cultist+ ?
	}

	immediate = {
		# set ig leader character to be Cultist - exclude devout initially?
		random_interest_group = {
			limit = { 
				NOT = { 
					leader = { 
						has_any_cultist_trait = yes
					} 
				}
			}
			leader = { 
				add_trait = nda_cultist 
				save_scope_as = converted_ig_leader
			}
			save_scope_as = converted_ig	
		}	
	}	
	
	option = { #"What can we do"
		name = nda_base.6.a
		default_option = yes
	}
}

nda_base.7 = { # The Cult in power - called from journal ' je_nda_cult_spreads' on completion
	type = country_event
	placement = ROOT
	title = nda_base.7.t
	desc = nda_base.7.d
	flavor =  nda_base.7.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = {

	}

	immediate = {
		set_variable = nda_cultists_in_open

		# set country to contain cultists. need better way of differtiating cultist culture and religion.
		add_primary_culture = cu:nda_cul_cultist # Adding Culture allows for Leaders of Culture despite no pop present!
		# set country states as homeland, convert % of pops to religion?
		every_scope_state = {
			state_region = {
				add_homeland = nda_cul_cultist
			}

			convert_population = { target = rel:nda_rel_cultist value = 0.10 }	
		}
		# add new IG to country just for cultist religion ?

		# notify players of change
		save_scope_as = originator

		every_country = {
			limit = {
				#is_player = yes
				#NOT = {has_journal_entry = je_nda_cult_spreads}
				#NOT = {has_variable = nda_cultists_in_open} # don't rerun
			}

			post_notification = nda_first_open_cult # this is not noticable (like most notices) go back to event ?
			#trigger_event = { id = nda_base.? }	

		}
		
		set_global_variable = nda_cultists_in_open	

		# if ELD exists offer an obligation if lesser ranked
		random_country = {
			limit = {
				exists = c:ELD
				c:ELD = { country_rank > root.country_rank }
				NOT = { owes_obligation_to = c:ELD }		
			}
			debug_log = "Offer Obligation to ELD on becoming Cultist" #[ROOT.GetName] : 
			set_owes_obligation_to = { country = c:ELD setting = yes }
			change_relations = { country = c:ELD value = 50 } # 30 was too low?
		}

		# Need to try and spread further so pass off to a non-cultist neighbour
		random_country = {
			limit = {
				is_adjacent = ROOT
				NOT = {has_journal_entry = je_nda_cult_spreads}
				NOT = {has_variable = nda_cultists_in_open}
			}
			trigger_event = { id = nda_base.8 }	# spread the cult
		}
		
	}	
	
	option = { #So it begins
		name = nda_base.7.a
		default_option = yes
	}
}

nda_base.8 = { # Notification that first country has recognized cult
	type = country_event
	placement = ROOT
	title = nda_base.8.t
	desc = nda_base.8.d
	flavor =  nda_base.8.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
		
	}
#	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = {
		
	}

	immediate = {
		# start journal for initial cult spread
		if = {
			limit = {
				NOT = {has_journal_entry = je_nda_cult_spreads}
				NOT = {has_variable = nda_cultists_in_open} # don't rerun
				has_events = yes # can get events and journals
			}
			debug_log = "Cult Expanded from Neighbour" #[ROOT.GetName] : 
			add_journal_entry = { type = je_nda_cult_spreads }	
				
		}
	}	
	
	option = { #Curse Them!
		name = nda_base.8.a
		default_option = yes
	}
}


nda_base.9 = { # Is there some non-conformists within the cult
	type = country_event
	placement = ROOT
	title = nda_base.9.t
	desc = nda_base.9.d
	flavor =  nda_base.9.f

	duration = 3

	#event_image = {
	#	video = "gfx/event_pictures/southamerica_war_civilians.bk2"
	#	
	#}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	#on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	#on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	gui_window = event_window_1char_tabloid

	left_icon = scope:targeted_ig_leader # converted_ig.leader

	trigger = {
		OR = {
			AND = {
				exists = c:ELD
				c:ELD = ROOT
			}
			AND = {
				exists = c:YIG
				c:YIG = ROOT
			}					
		}

		any_interest_group = {
			leader = { 
				has_eldritch_trait = yes
				OR = {
					has_ideology = ideology_radical
					has_ideology = ideology_pacifist
				}
			} 
		}	
	}

	immediate = {
		# start journal for initial cult spread

		random_interest_group = {
			limit = { 
				leader = { 
					has_eldritch_trait = yes
					OR = {
						has_ideology = ideology_radical
						has_ideology = ideology_pacifist
					}
				} 
			}
			leader = {
				save_scope_as = targeted_ig_leader
			}
			save_scope_as = targetted_ig	
		}

		debug_log = "Check for Non-Conformists" 				

	}	
	
	option = { #Persuade Them!
		name = nda_base.9.a
		default_option = yes
		
		ai_chance = { # should be most likely
			base = 100		
		}

		scope:targeted_ig_leader = { set_ideology = ideology_moderate } # This ignores ideology possibility checks?
		debug_log = "Check for Non-Conformists - Persuaded" 	
		# rdeuce radicals in IG as well? Change Anger?
	}	

	option = { #Ignore Them! # For Players only ?
		name = nda_base.9.b

		ai_chance = { # should be never
			base = 0		
		}
	}
}



