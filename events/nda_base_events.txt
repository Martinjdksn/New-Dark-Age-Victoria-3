namespace = nda_base

nda_base.1 = { # An Introduction to NDA
	type = country_event
	placement = ROOT
	title = nda_base.1.t
	desc = nda_base.1.d
	flavor =  nda_base.1.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"	
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds" #event_fire.dds"

	trigger = {
		has_global_variable = nda_is_loaded # use this here to stop error log entry - event is direct call, not on_action, so no harm done
	}

	option = { #So it begins
		name = nda_base.1.a
		default_option = yes
	}
}

nda_base.2 = { # Nameless Cults published
	type = country_event
	placement = p:x2101E0 #ROOT
	title = nda_base.2.t
	desc = nda_base.2.d
	flavor =  nda_base.2.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_politicians_arguing.bk2"		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/tutorial_icon.dds"

	trigger = {
 		# 1839 and owner of dusseldorf
		game_date >= 1839 
		p:x7543C8 = { state = { owner = ROOT } }

		NOT = {has_global_variable = nda_nameless_cults_exists}
	}

	immediate = {
		set_global_variable = nda_nameless_cults_exists

		# set target countries for intial YIG and DGN expansions - needed to give competition to sole potential countries
		random_country = {
			limit = {
				country_rank >= rank_value:unrecognized_regional_power	
				
				NOT = { has_variable = nda_nameless_cults_selected }
				any_scope_state = { 
					is_potentially_yigian = yes
				}
			}

			set_variable = nda_nameless_cults_selected
		}
		random_country = {
			limit = {
				country_rank >= rank_value:unrecognized_regional_power	

				NOT = { has_variable = nda_nameless_cults_selected }
				any_scope_state = { 
					is_potentially_yigian = yes
				}
			}

			set_variable = nda_nameless_cults_selected
		}
		random_country = {
			limit = {
				country_rank >= rank_value:unrecognized_regional_power	

				NOT = { has_variable = nda_nameless_cults_selected }
				any_scope_state = { 
					is_potentially_dagonic = yes
				}
			}

			set_variable = nda_nameless_cults_selected
		}
		random_country = {
			limit = {
				country_rank >= rank_value:unrecognized_regional_power					

				NOT = { has_variable = nda_nameless_cults_selected }
				any_scope_state = { 
					is_potentially_dagonic = yes
				}
			}

			set_variable = nda_nameless_cults_selected
		}
	}	
	
	option = { #"What harm can a book do?"
		name = nda_base.2.a
		default_option = yes
		
		ai_chance = { # will +ve effect conversion rate
			base = 80		
		}

		# annoy the clergy
		ig:ig_devout = {
			add_modifier = {
	            name = permitted_obscene_publication
	            months = 36
	        }
		}

		# the intellectuals approve
		ig:ig_intelligentsia = {
			add_modifier = {
	            name = championed_free_speech
	            months = 36
	        }
		}
		set_variable = nda_nameless_cults
	}

	option = { #"Such writings must be supressed!"
		name = nda_base.2.b

		ai_chance = { # will -ve effect conversion rate
			base = 20		
		}

		# annoy the intelectuals
		ig:ig_intelligentsia = {
			add_modifier = {
	            name = curtailed_free_speech
	            months = 36
	        }
		}
		# the church approves
		ig:ig_devout = {
			add_modifier = {
	            name = stopped_obscene_publication
	            months = 36
	        }
		}
		set_variable = nda_nameless_cults_supressed
	}
}

nda_base.3 = { # Imprint of Nameless Cults - as above but for other major countries 
	type = country_event
	placement = ROOT
	title = nda_base.3.t
	desc = nda_base.3.d
	flavor =  nda_base.3.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_politicians_arguing.bk2"
		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/tutorial_icon.dds"

	trigger = {
 		# 1840 and not dusseldorf
		game_date >= 1840
		has_global_variable = nda_nameless_cults_exists

		NOT = { has_variable = nda_nameless_cults_decision } # don't rerun while decision in progress

		OR = { # will also fire for countries as they promote in rank
			country_rank = rank_value:great_power
			country_rank = rank_value:major_power
			AND = { # Alway for New England
				exists = c:NEN
				c:NEN = ROOT
			}

			# random countries previously selected in yigian lands to rival brazil and also in dagonic shores
			has_variable = nda_nameless_cults_selected
		}

		# redundant to spread to cult country
		NOT = {
			is_full_cult_country = { COUNTRY="ROOT" }				
		}
	}

	immediate = {
		set_variable = nda_nameless_cults_decision # don't set immediate as causes follow on event to trigger simultaniously	
		debug_log = "Imprint of Nameless Cults : [THIS.GetCountry.GetNameNoFormatting]" 
	}	
	
	option = { #"What harm can a book do?"
		name = nda_base.3.a
		default_option = yes
		
		ai_chance = { # will +ve effect conversion rate
			base = 80		
		}

		# annoy the clergy
		ig:ig_devout = {
			add_modifier = {
	            name = permitted_obscene_publication
	            months = 36
	        }
		}

		# the intellectuals approve
		ig:ig_intelligentsia = {
			add_modifier = {
	            name = championed_free_speech
	            months = 36
	        }
		}

		set_variable = nda_nameless_cults
	}

	option = { #"Such writings must be supressed!"
		name = nda_base.3.b

		ai_chance = { # will -ve effect conversion rate
			base = 20		
		}

		# annoy the intelectuals
		ig:ig_intelligentsia = {
			add_modifier = {
	            name = curtailed_free_speech
	            months = 36
	        }
		}
		# the church approves
		ig:ig_devout = {
			add_modifier = {
	            name = stopped_obscene_publication
	            months = 36
	        }
		}

		set_variable = nda_nameless_cults_supressed
	}
}

nda_base.4 = { # The Death of Junzt
	type = country_event
	placement = p:x2101E0 #ROOT
	title = nda_base.4.t
	desc = nda_base.4.d
	flavor =  nda_base.4.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_vandalized_storefront.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
 		# 1841 - msg to all players
		game_date >= 1841
		game_date < 1842 # Can clear variables out after this date ?
		has_global_variable = nda_nameless_cults_exists
		NOT = { has_variable = nda_nameless_cults_junztdeath  }
	}

	immediate = {
		set_variable = nda_nameless_cults_junztdeath # don't need unless notifing abroad?
	}	
	
	option = { #So it begins
		name = nda_base.4.a
		default_option = yes
	}
}

# Cultist in government - mostly hidden?
nda_base.5 = { # First Cultist in Country
	type = country_event
	placement = ROOT
	title = nda_base.5.t
	desc = nda_base.5.d
	flavor =  nda_base.5.f

	duration = 3

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	#event_image = {  texture = "gfx/event_pictures/event1.dds"  } # dummy image

	gui_window = event_window_1char_tabloid

	left_icon = scope:converted_ig.leader

	trigger = {
		OR = {
			has_variable = nda_nameless_cults
			AND = {
				has_variable = nda_nameless_cults_supressed 		
				has_global_variable = nda_cultists_in_open	# delay till a country is converted
			}
		}

		can_cult_infiltrate = yes
	}

	immediate = {
		# set ig leader character to be Cultist - exclude devout initially?
		random_interest_group = {
			limit = { NOT = { is_interest_group_type = ig_devout } }
			leader = { 
				add_trait = nda_cultist 
				save_scope_as = converted_ig_leader
				}
				save_scope_as = converted_ig					
		}

		# start journal for initial cult spread
		if = {
			limit = {
				can_cult_infiltrate = yes

				NOT = {is_full_cult_country = { COUNTRY="ROOT"}} # don't do for existing bad guys
			}
			add_journal_entry = { type = je_nda_cult_spreads }		
		}

		debug_log_scopes = no				
	}	
	
	option = { #"What can we do"
		name = nda_base.5.a
		default_option = yes
	}
}

nda_base.6 = { # Secret Cultists in Country - only fired from journals: je_nda_cult_spreads - since there may be no target this should be hidden and only call visible event if valid
	type = country_event
	hidden = yes 

	trigger = {
		#should prevent assignment if all ig already has cultist+ ?
	}

	immediate = {
		# set ig leader character to be Cultist - exclude devout initially?
		random_interest_group = {
			limit = { 
				NOT = { 
					leader = { 
						has_any_cultist_trait = yes
					} 
				}
			}
			leader = { 
				add_trait = nda_cultist 
				save_scope_as = converted_ig_leader
			}
			save_scope_as = converted_ig	
		}	
		# if scope converted_ig_leader does not exist don't call
		if = { 
			limit = { exists = scope:converted_ig_leader }
			trigger_event = { id = nda_base.12 }	
		}
	}	

}

nda_base.7 = { # The Cult in power - called from journal ' je_nda_cult_spreads' on completion
	type = country_event
	placement = ROOT
	title = nda_base.7.t
	desc = nda_base.7.d
	flavor =  nda_base.7.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = {

	}

	immediate = {
		if = {
			limit = {
				NOT = { has_variable = nda_cultists_in_open }
			}

			set_variable = nda_cultists_in_open

			# set country to contain cultists.
			add_primary_culture = cu:nda_cul_cultist # Adding Culture allows for Leaders of Culture despite no pop present!
			# set country states as homeland, convert % of pops to religion?
			every_scope_state = {
				state_region = {
					add_homeland = nda_cul_cultist
				}

				convert_population = { target = rel:nda_rel_cultist value = 0.10 }	
			}
			# add new IG to country just for cultist religion ?

			# notify players of change
			save_scope_as = originator

			every_country = {
				limit = { is_player = yes }
				this = {
					post_notification = nda_first_open_cult # this is not noticable (like most notices) go back to event ?					
				}
			}
			
			set_global_variable = nda_cultists_in_open	

			# if ELD exists offer an obligation if lesser ranked
			random_country = {
				limit = {
					exists = c:ELD
					c:ELD = { country_rank > root.country_rank }
					NOT = { owes_obligation_to = c:ELD }		
				}
				debug_log = "Offer Obligation to ELD on becoming Cultist : [THIS.GetCountry.GetNameNoFormatting]" #[ROOT.GetName] : 

				set_owes_obligation_to = { country = c:ELD setting = yes }
				change_relations = { country = c:ELD value = 50 } # 30 was too low?
			}

			# Need to try and spread further so pass off to a non-cultist neighbour
			random_country = {
				limit = {
					is_adjacent = ROOT
					can_cult_infiltrate = yes
				}
				trigger_event = { id = nda_base.8 }	# spread the cult
			}
		}		
	}	
	
	option = { #So it begins
		name = nda_base.7.a
		default_option = yes
	}
}

nda_base.8 = { # Neigbouring country has spread cult to us
	type = country_event
	placement = ROOT
	title = nda_base.8.t
	desc = nda_base.8.d
	flavor =  nda_base.8.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
		
	}
#	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = {
		
	}

	immediate = {
		# start journal for additional cult spread
		if = {
			limit = {
				can_cult_infiltrate = yes
			}
			debug_log = "Cult Expanded from Neighbour : [THIS.GetCountry.GetNameNoFormatting]" #[ROOT.GetName] : 
			#debug_log_scopes = no
			add_journal_entry = { type = je_nda_cult_spreads }	
				
		}
	}	
	
	option = { #Hurrah!
		name = nda_base.8.a
		default_option = yes
	}
}


nda_base.9 = { # Is there some non-conformists within the cult
	type = country_event
	placement = ROOT
	title = nda_base.9.t
	desc = nda_base.9.d
	flavor =  nda_base.9.f

	duration = 3

	gui_window = event_window_1char_tabloid

	left_icon = scope:targeted_ig_leader # converted_ig.leader

	trigger = {
		is_full_cult_country = { COUNTRY="ROOT" }

		any_interest_group = {
			leader = { 
				has_any_cultist_trait = yes
				has_non_cultist_ideology = yes
			} 
		}	
		#any_scope_character = {
		#	has_any_cultist_trait = yes
		#	has_non_cultist_ideology = yes
		#}	
	}

	immediate = {
		random_interest_group = {
			limit = { 
				leader = { 
					has_any_cultist_trait = yes
					has_non_cultist_ideology = yes
				} 
			}
			leader = {
				save_scope_as = targeted_ig_leader
			}
			save_scope_as = targetted_ig	
		}

		debug_log = "Check for Non-Conformists" 				

	}	
	
	option = { #Persuade Them!
		name = nda_base.9.a
		default_option = yes
		
		ai_chance = { # should be most likely
			base = 100		
		}

		# have chance of traditionalist as well?
		scope:targeted_ig_leader = { 
			nda_effect_ensure_cult_ideology = yes	
		} 
		debug_log = "Check for Non-Conformists - Persuaded" 	
		debug_log_scopes = yes
		# rdeuce radicals in IG as well? Change Anger?
	}	

	option = { #Ignore Them! # For Players only ?
		name = nda_base.9.b

		ai_chance = { # should be never
			base = 0		
		}
	}
}

nda_base.10 = { # Notifications that the Eldritch Realms hs formed
	type = country_event
	#hidden = yes # if there are no option, make it hidden
	placement = ROOT
	title = nda_base.10.t
	desc = nda_base.10.d
	flavor =  nda_base.10.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"	
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = {
		AND = {
				exists = c:ELD
				c:ELD = ROOT
		}
		NOT = { has_global_variable = nda_eldritch_realm_founded} 
	}

	immediate = {

		set_global_variable = nda_eldritch_realm_founded

		# send out notification		
		every_country = {
			limit = {
				#is_player = yes
				NOT = {	c:ELD = ROOT }
			}

			post_notification = nda_elditch_realm_proclaimed # toast

		}

		# set up Leaders and IG's
		nda_effect_eldritch_setup = yes

		# spread to non-cultist  Neighbour
		random_country = {
			limit = {
				is_adjacent = ROOT
				can_cult_infiltrate = yes
			}
			trigger_event = { id = nda_base.8 }	# spread the cult
		}

		# trigger events for other cult countries to bow down/offer tribute/ignore

	}	
	
	option = { # #Hurrah!
		name = nda_base.10.a
		default_option = yes
	}
}

# Redundant - now uses on_action
nda_base.11 = { # Boost War Score Values - can't limit buff as can't set variable against wars
	type = country_event
	placement = ROOT
	title = nda_base.11.t
	desc = nda_base.11.d
	flavor =  nda_base.11.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds" #event_fire.dds"

	trigger = {
		NOT = { has_global_variable = nda_ritual_cthulhu_leaves } # he's gone so no further bonuses
		is_full_cult_country = { COUNTRY="THIS" }
	
		is_at_war = yes
		is_player = no # only buff for AI because AI needs all the help it can get
		#any_scope_war = { # war does not support variables
		#	NOT = { has_variable = nda_eld_war_buff }
		#}
	}

	immediate = {
		debug_log = "Cult : add buff"

		random_scope_war = {
			#limit = {
			#	NOT = { has_variable = nda_eld_war_buff } # This scope doesn't support variables. Scope: War
			#}
			save_scope_as = eldritch_war
		}
	}	
	
	option = { #Try Harder
		name = nda_base.11.a
		default_option = yes

		trigger = {
			NOT = { 
				AND = {
					exists = c:ELD
					has_war_with = c:ELD # no bonus for hitting boss guy
				}
			} 
		}

		# buff the war score
		scope:eldritch_war = {
			IF = {
				limit = { 
					has_war_support = { target = ROOT value < 40 } 
					has_war_exhaustion = { target = ROOT value < 100 } # need some sort of throttle to stop death war
				}
				add_war_exhaustion = { target = ROOT value = -0.2 }
				add_war_war_support = { target = ROOT value = 1 }

				debug_log = "add buff"				
			}
			# boost if Cthulhu in town
			IF = {
				limit = { has_global_variable = nda_cthulhu_arrives }
				add_war_war_support = { target = ROOT value = 1 }

				debug_log = "add Cthulhu buff"				
			}
		}

	}

	option = { #Not Good Idea
		name = nda_base.11.b
		
		trigger = {
			exists = c:ELD
			has_war_with = c:ELD # no bonus for hitting boss guy
		}

		# nerf the war score to back out of war
		scope:eldritch_war = {
			add_war_exhaustion = { target = ROOT value = 0.5 }
			add_war_war_support = { target = ROOT value = -1 }

			debug_log = "negative buff"
		}

	}

	option = { #Don't over do it
		name = nda_base.11.c	
	}
}

nda_base.12 = { # Secret Cultists in Country - fired from event nda_base.6 called by journals: je_nda_cult_spreads
	type = country_event
	placement = ROOT
	title = nda_base.12.t
	# if already repented then they have gone back on their word

	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:converted_ig_leader = {
						has_variable = nda_repented
					}
				}
				desc = nda_base.12.u
			}
			# standard 
			triggered_desc = {
				trigger = {
					NOT = { 
						scope:converted_ig_leader = {
							has_variable = nda_repented
						}
					}
				}

				desc = nda_base.12.d
			}
		}
	}

	flavor =  nda_base.12.f

	duration = 3

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"
	
	gui_window = event_window_1char_tabloid

	left_icon = scope:converted_ig_leader

	trigger = {

	}

	immediate = {
		# set ig leader character to be Cultist - already done by calling event - scoped leader should still be available for text
	}	
	
	option = { #"What can we do"
		name = nda_base.12.a
		default_option = yes
	}
}

nda_base.13 = { # The Cult fails to spread
	type = country_event
	placement = ROOT
	title = nda_base.13.t
	desc = nda_base.13.d
	flavor =  nda_base.13.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/southamerica_war_civilians.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/unspecific/world_fair"

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds" #event_fire.dds"

	trigger = {
		# direct from journal: je_nda_cult_spreads on fail
	}

	immediate = {
		set_variable = nda_cult_spread_failed
	}	
	
	option = { #We will be waiting
		name = nda_base.13.a
		default_option = yes

		nda_effect_eldritch_anger = yes
	}
	option = { #May be your right
		name = nda_base.13.b
		
		# remove fail variable - should allow retrigger of journal
		remove_variable = nda_cult_spread_tracker		
		remove_variable = nda_cult_spread_failed	
	}
	option = { # Yours is a failed philosophy 
		# Cthulhu is gone so no response from despondent cultists
		name = nda_base.13.c
		trigger = { has_global_variable = nda_ritual_cthulhu_leaves }
		ai_chance = { # should be most likely if available
			base = 100		
		}		
	}
}

nda_base.14 = { # Revolt Cultist Countries have flags removed - reinstate them
	type = country_event
	hidden = yes 

	trigger = {
		is_full_cult_country = { COUNTRY="THIS" } # any full cult country
		NOT = { has_variable = nda_cultists_in_open }
	}

	immediate = {
		set_variable = nda_cultists_in_open
		set_variable = {
			name = nda_cult_spread_tracker
			value = 901
		}

		if = { # Eldritch only
			limit = { 				
				exists = c:ELD
				c:ELD = ROOT 
			}

			# Set up Eldritch leadership and IGs
			nda_effect_eldritch_setup = yes
		}
		else_if = { # Yigian only
			limit = { 				
				exists = c:YIG
				c:YIG = ROOT 
			}

			set_variable = nda_yig_in_open
			set_variable = {
				name = nda_cult_to_yigian_tracker
				value = 301
			}

			# Set up Yigian leadership and IGs
			nda_effect_yigian_setup = yes
		}
		else_if = { # Dagonic only
		
			limit = { 				
				exists = c:DGN
				c:DGN = ROOT 
			}

			set_variable = nda_dagon_in_open
			set_variable = {
				name = nda_cult_to_dagonic_tracker
				value = 301
			}

			# Set up Dagonic leadership and IGs
			nda_effect_dagonic_setup = yes
		}
	}	
}

nda_base.15 = { # Is there non-conformists leader within the cult
	type = country_event
	placement = ROOT
	title = nda_base.15.t
	desc = nda_base.15.d
	flavor =  nda_base.15.f

	duration = 3

	gui_window = event_window_1char_tabloid

	left_icon = scope:targeted_ig_leader # converted_ig.leader

	trigger = {
		exists = ig:ig_nda_cult_worshippers
		ig:ig_nda_cult_worshippers = {
			leader = { 
				has_any_cultist_trait = yes
				has_non_cultist_ideology = yes
			} 
		}		
	}

	immediate = {
		ig:ig_nda_cult_worshippers = {
			leader = { 
				save_scope_as = targeted_ig_leader
				nda_effect_ensure_cult_ideology = yes					
			} 
		}

		debug_log = "Check for Non-Conformist Cult Leader" 				

	}	
	
	option = { # To be expected
		name = nda_base.15.a
		default_option = yes
		
		ai_chance = { # should be most likely
			base = 100		
		}

		debug_log = "Non-Conformist Cult Leader - Persuaded" 	

	}	
}

nda_base.20 = { # Request from the devout
	type = country_event
	placement = ROOT
	title = nda_base.20.t
	desc = nda_base.20.d
	flavor =  nda_base.20.f

	duration = 3

	# should be character block
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_scales.dds" #icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds" 

	#event_image = {  texture = "gfx/state_pictures/arctic.dds"  } # dummy image

	gui_window = event_window_1char_tabloid

	left_icon = scope:devout_ig_leader

	trigger = {

		OR = {
			is_player = yes
			AND = {
				exists = c:NEN
				c:NEN = ROOT
			}
		}

		# redundant to spread to cult country
		NOT = {
			is_full_cult_country = { COUNTRY="ROOT" }				
		}	
		NOT = { has_variable = nda_devout_offer }

		AND = {
			has_journal_entry = je_nda_cult_spreads
			var:nda_cult_spread_tracker > 5 # Don't do immediate pop-up			
		}

		any_interest_group = { # from devout only
			is_interest_group_type = ig_devout 
			leader = { has_any_cultist_trait = no } # must be 'clean'
		}
	}

	immediate = {
		set_variable = nda_devout_offer

		random_interest_group = { # from devout only
			limit = { 
				is_interest_group_type = ig_devout 
				leader = { has_any_cultist_trait = no }
			}
			leader = { 
				save_scope_as = devout_ig_leader
			}
		}

		debug_log = "Devout Offer" 
	}	
	
	option = { #"Inquisition?"
		name = nda_base.20.a

		ai_chance = { # will +ve effect conversion rate
			base = 80		
		}

		add_journal_entry = { type = je_nda_devout_inquisition }		
	}

	option = { #"Silly"
		name = nda_base.20.b
		default_option = yes

		ai_chance = { # will +ve effect conversion rate
			base = 20		
		}
	}
}

nda_base.21 = { # A cultist targeted 
	type = country_event
	hidden = yes 

	immediate = {
		# set ig leader character to be Cultist - exclude devout initially?
		random_interest_group = {
			limit = {
				NOT = { is_interest_group_type = ig_devout } # Don't include devout as contradicts journal fail condition
				leader = { 
					has_any_cultist_trait = yes
				} 			
			}
			leader = { 
				save_scope_as = targeted_ig_leader
			}
			save_scope_as = targeted_ig
		}	
		# if scope converted_ig_leader does not exist don't call
		if = { 
			limit = { exists = scope:targeted_ig_leader }
			
			if = {
				limit = { scope:targeted_ig_leader = { has_trait = nda_master } }
				# not going to work
				trigger_event = { id = nda_base.23 }	
			}	
			else = {
				trigger_event = { id = nda_base.22 }	
			}		
		}
	}
}

nda_base.22 = { # A Cultist converted 
	type = country_event
	placement = ROOT
	title = nda_base.22.t
	desc = nda_base.22.d
	flavor =  nda_base.22.f

	duration = 3

	# should be character block
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_scales.dds" #icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds" 

	#event_image = {  texture = "gfx/state_pictures/arctic.dds"  } # dummy image

	gui_window = event_window_1char_tabloid

	left_icon = scope:targeted_ig_leader

	trigger = {
		# from nda_base.21 only
	}

	immediate = {
		scope:targeted_ig_leader = {
			# remove traits
			remove_trait = nda_cultist
			remove_trait = nda_acolyte

			set_variable = { name = nda_repented }
		}

		debug_log = "Cult Traits Removed" 
	}	
	
	option = { #"Saw Sense"
		name = nda_base.22.a
		default_option = yes
	}

	option = { #"No forgivness"
		name = nda_base.22.b
		scope:targeted_ig_leader = {
				kill_character = yes
		}
	}
}

nda_base.23 = { # A Cultist refuses 
	type = country_event
	placement = ROOT
	title = nda_base.23.t
	desc = nda_base.23.d
	flavor =  nda_base.23.f

	duration = 3

	# should be character block
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds"

	#event_image = {  texture = "gfx/state_pictures/arctic.dds"  } # dummy image

	gui_window = event_window_1char_tabloid

	left_icon = scope:targeted_ig_leader

	trigger = {
		# from nda_base.21 only
	}

	immediate = {

	}	
	
	option = { #"Oh dear."
		name = nda_base.23.a
	}
}

nda_base.24 = { # The Inquisition ends 
	type = country_event
	placement = ROOT
	title = nda_base.24.t
	desc = nda_base.24.d
	flavor =  nda_base.24.f

	duration = 3

	# should be character block
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_scales.dds" #icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds" 

	gui_window = event_window_1char_tabloid

	left_icon = scope:devout_ig_leader

	trigger = {
		# from je_nda_devout_inquisition only
	}

	immediate = {
		random_interest_group = { # from devout only
			limit = { 
				is_interest_group_type = ig_devout 
			}
			leader = { 
				save_scope_as = devout_ig_leader
			}
		}
	}	
	
	option = { #"Oh dear."
		name = nda_base.24.a
	}
}

nda_base.26 = { # The Pit and the Pendulum!
	type = country_event
	placement = ROOT
	title = nda_base.26.t 
	desc = nda_base.26.d
	flavor =  nda_base.26.f

	duration = 3

	# should be character block
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_scales.dds" #icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds" 

	gui_window = event_window_2char

	left_icon = scope:targeted_ig_leader
	right_icon = scope:devout_ig_leader
	trigger = {
		
	}

	weight_multiplier = {
		base = 0
		modifier = {
			has_variable =  "nda_innocent_condemmed"
			add = 10
		}
	}

	immediate = {
		random_interest_group = {
			limit = { 				
				leader = { 
					has_any_cultist_trait = no
				} 	
				NOT = { is_interest_group_type = ig_devout } # Don't include devout	
			}
			leader = { 				
				save_scope_as = targeted_ig_leader
			}
			save_scope_as = targeted_ig
		}	
		random_interest_group = { # devout leader
			limit = { 
				is_interest_group_type = ig_devout 
			}
			leader = { 
				save_scope_as = devout_ig_leader
			}
		}
	}	
	
	option = { #"We must end this atrocity"
		name = nda_base.26.a
		default_option = yes
		# stop the Inquisition
		custom_tooltip = nda_base_inqusition_closed_tooltip
		hidden_effect = { set_variable = nda_inqusition_closed }

		# bad debuff for devout, inqusition ends
	}

	option = { #"Mistakes happen"
		name = nda_base.26.b
		# bad debuff for devout and government
	}
}

nda_base.25 = { # An Innocent condemned 
	type = country_event
	placement = ROOT
	title = nda_base.22.t #same descriptions as gulity!
	desc = nda_base.22.d
	flavor = nda_base.22.f

	duration = 3

	# should be character block
	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/misc/1Character_Banner"

	icon = "gfx/interface/icons/event_icons/event_scales.dds" #icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds" 

	gui_window = event_window_1char_tabloid

	left_icon = scope:targeted_ig_leader

	trigger = {
		# from nda_base.21 only
	}

	immediate = {
		random_interest_group = {
			limit = { 				
				leader = { 
					has_any_cultist_trait = no
				} 	
				NOT = { is_interest_group_type = ig_devout } # Don't include devout	
			}
			leader = { 				
				save_scope_as = targeted_ig_leader
			}
			save_scope_as = targeted_ig
		}	

		# possibility of negative trait due to torture
		random_list = {	
			25 = { } 
			25 = { scope:targeted_ig_leader = { add_trait = alcoholic } }
			25 = { scope:targeted_ig_leader = { add_trait = psychological_affliction } }
			25 = { scope:targeted_ig_leader = { add_trait = opium_addiction } }
		}		
	
		debug_log = "Innocent persecuted" 
		set_variable = "nda_innocent_condemmed"
	}	
	
	option = { #"Saw Sense"
		name = nda_base.22.a
		default_option = yes
	}

	option = { #"No forgivness"
		name = nda_base.22.b
		scope:targeted_ig_leader = {
				kill_character = yes
		}
	}
}