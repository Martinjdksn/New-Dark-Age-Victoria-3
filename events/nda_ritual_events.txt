namespace = nda_ritual

nda_ritual.1 = { # Cthulhu Returns
	type = country_event
	placement = ROOT
	title = nda_ritual.1.t
	desc = nda_ritual.1.d
	flavor =  nda_ritual.1.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect ="event:/SFX/Events/unspecific/devastation"

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds"

	trigger = { # limit to eldritch cult ELD ? Called Only?
		has_global_variable = nda_ritual_completed	
		game_date >= 1925.3.23	
		NOT = {
			has_global_variable = nda_cthulhu_arrives	# run once
		 }

	}

	immediate = {
		set_global_variable = nda_cthulhu_arrives	
		every_country = {
			limit = {
				OR = { 
					is_full_cult_country = { COUNTRY="THIS" }	
					is_player = yes
				}
			}
			set_variable = nda_cthulhu_timer_active
			set_variable = {
				name = nda_cthulhu_timer
				days = 3650
				value = yes
			}			
		}
		nda_effect_cthulhu_arrives = yes
		debug_log = "Ritual - Stars are Right"

		#trigger_event = { id = nda_ritual.4 years = 10 } # leaves in 10 years # this is flakey - sometimes does not trigger

		every_country = {
			post_notification = nda_ritual_cthulhu_returns
		}
	}	
	
	option = { #So it begins
		name = nda_ritual.1.a
		default_option = yes
	}
}

nda_ritual.2 = { # Cthulhu Early Return
	type = country_event
	placement = ROOT
	title = nda_ritual.2.t
	desc = nda_ritual.2.d
	flavor =  nda_ritual.2.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect ="event:/SFX/Events/unspecific/devastation"

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds"

	trigger = { # limit to eldritch cult ELD ? Called Only?
		has_global_variable = nda_ritual_completed	
		game_date >= 1890.8.20  # HPL's Birthday
		game_date < 1891 
		NOT = {
			has_global_variable = nda_cthulhu_arrives	# run once
		 }

	}

	immediate = {
		set_global_variable = nda_cthulhu_arrives	
		every_country = {
			limit = {
				OR = { 
					is_full_cult_country = { COUNTRY="THIS" }	
					is_player = yes
				}
			}
			set_variable = nda_cthulhu_timer_active
			set_variable = {
				name = nda_cthulhu_timer
				days = 7300
				value = yes
			}			
		}
		
		nda_effect_cthulhu_arrives = yes
		debug_log = "Ritual - Stars are Right Early"

		#trigger_event = { id = nda_ritual.4 years = 20 } # leaves in 20 years - longer than normal as reward  # this is flakey - sometimes does not trigger

		every_country = {
			post_notification = nda_ritual_cthulhu_returns
		}
	}	
	
	option = { #So it begins
		name = nda_ritual.1.a
		default_option = yes
	}
}

nda_ritual.3 = { # The ritual completed
	type = country_event
	placement = ROOT
	title = nda_ritual.3.t
	desc = nda_ritual.3.d
	flavor =  nda_ritual.3.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds"

	trigger = { # Called Only?

	}

	immediate = {
		set_global_variable = nda_ritual_completed	
		debug_log = "Ritual - Completed"	
	}	
	
	option = { # Just a matter of time
		name = nda_ritual.3.a
		default_option = yes
	}
}

nda_ritual.4 = { # Cthulhu Leaves
	type = country_event
	placement = ROOT
	title = nda_ritual.4.t
	desc = nda_ritual.4.d
	flavor =  nda_ritual.4.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = { 
		has_global_variable = nda_cthulhu_arrives
		NOT = { has_global_variable = nda_ritual_cthulhu_leaves }
		has_variable = nda_cthulhu_timer_active
		NOT = { has_variable = nda_cthulhu_timer } # time has run out
	}

	immediate = {
		set_global_variable = nda_ritual_cthulhu_leaves	
		debug_log = "Ritual - Cthulhu Leaves"	

		nda_effect_cthulhu_leaves = yes

		every_country = {
			post_notification = nda_ritual_cthulhu_leaves
		}
	}	
	
	option = { # Just a matter of time
		name = nda_ritual.4.a
		default_option = yes
	}
}

nda_ritual.5 = { # The world surrenders. - Boost ELD by auto adding Cult countries on a regular basis
	type = country_event
	placement = ROOT
	title = nda_ritual.5.t
	desc = nda_ritual.5.d
	flavor =  nda_ritual.5.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds"

	trigger = { 
		
		# Cthulhu is still here
		has_global_variable = nda_cthulhu_arrives
		NOT = { has_global_variable = nda_ritual_cthulhu_leaves	}
		AND = {
			exists = c:ELD
			c:ELD = ROOT
		}	
		is_player = no # only for AI
		# Has country that can join ELD
		any_country = { 
			is_player = no
			is_country_alive = yes
			NOT = {
				is_full_cult_country = { COUNTRY="THIS" }				
			}
			country_has_primary_culture = cu:nda_cul_cultist
		}

	}

	immediate = {
		debug_log = "Ritual - The world surrenders."	

		# random select country to join ELD
		nda_effect_eldritch_annex = yes
	}	
	
	option = { # Good. Good.
		name = nda_ritual.5.a
		default_option = yes
	}
}

nda_ritual.6 = { # Dismantle Empire - don't think this is really working well - need to dimantle core ELD not just hangers on.
	type = country_event
	placement = ROOT
	title = nda_ritual.6.t
	desc = nda_ritual.6.d
	flavor =  nda_ritual.6.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = { 
		has_global_variable = nda_ritual_cthulhu_leaves	
		AND = {
			exists = c:ELD
			c:ELD = ROOT
		}	
		is_player = no # only for AI

		# has subject that is not a cultist stronghold
		any_country = {
			is_subject_of = c:ELD
			NOT = { country_has_primary_culture = cu:nda_cul_cultist }
		}
	}

	immediate = {
		
		random_country = {
			limit = {
				is_subject_of = c:ELD	
				#NOT = { country_has_primary_culture = cu:nda_cul_cultist }			
			}

			make_independent = yes

			if = {
				limit = { country_has_primary_culture = cu:nda_cul_cultist }

				remove_primary_culture = cu:nda_cul_cultist				
			}	
			save_scope_as = nda_eldritch_freedom
			every_country = {
				post_notification = nda_ritual_post_cthulhu_split
			}
			debug_log = "Ritual - Eldritch Cult Splits"					
		}	
	}	
	
	option = { # It's Over
		name = nda_ritual.6.a
		default_option = yes
	}
}

nda_ritual.7 = { # Unrest in Eldritch lands
	type = country_event
	placement = ROOT
	title = nda_ritual.7.t
	desc = nda_ritual.7.d
	flavor =  nda_ritual.7.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = { 
		has_global_variable = nda_ritual_cthulhu_leaves	
		AND = {
			exists = c:ELD
			c:ELD = ROOT
		}	
		#is_player = no # only for AI

		# has subject that is not a cultist stronghold
		any_scope_culture = {
			NOT = { is_primary_culture_of = ROOT }
		}
	}

	immediate = {
		debug_log = "Ritual - Eldritch Cult Rebels Select"	
		nda_effect_eldritch_strife = yes
	}	
	
	option = { # It's Over
		name = nda_ritual.7.a
		default_option = yes
	}
}

# Call of Cthulhu story events
# The Tale of Inspector Legrasse - November 1907 New Orleans
# the American Archeological Society held its annual meeting in St. Louis.

nda_ritual.1907 = { 
	type = country_event
	placement = p:x9A7554 
	title = nda_ritual.1907.t
	desc = nda_ritual.1907.d # have different description if location is ELD??
	flavor =  nda_ritual.1907.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds"

	trigger = { 
		
 		# 1907 
		game_date >= 1907.11.1 
		game_date < 1908.2 

		# owner of New Orleans (or St Louis)
		OR = {
			p:x9A7554 = { state = { owner = ROOT } }
			AND = {
				exists = c:NEN
				c:NEN = ROOT
			}			
		}
			
		NOT = { has_variable = nda_ritual_legrasse }	

	}

	immediate = {
		set_variable = nda_ritual_legrasse	
		debug_log = "Ritual - The Tale of Inspector Legrasse "	

		if = { # Help ritual along
			limit = { has_global_variable = je_nda_ritual_proceeds_tracker  }

			change_global_variable = {
				name = je_nda_ritual_proceeds_tracker
				add = 100
			}		
		}
	}	
	
	option = { # A Strange Tale
		name = nda_ritual.1907.a
		default_option = yes
	}
}

nda_ritual.1860 = { # Webb expedition to Greenland - recovers idol - best as part of expedition journal?
	type = country_event
	placement = p:x8391B2 
	title = nda_ritual.1860.t
	desc = nda_ritual.1860.d 
	flavor =  nda_ritual.1860.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/europenorthamerica_antarctica.bk2"		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds"

	trigger = { 
		
 		# 1860 
		game_date >= 1860.5.1 
		game_date < 1861 

		AND = {
			exists = c:NEN
			c:NEN = ROOT
		}			
			
		NOT = { has_variable = nda_ritual_webb }	

	}

	immediate = {
		set_variable = nda_ritual_webb	
		debug_log = "Ritual - The Tale of Professor Webb "	

	}	
	
	option = { # A Strange Tale
		name = nda_ritual.1860.a
		default_option = yes
	}
}

nda_ritual.1925 = { #April - The Vigilant - only if Ritual fails
	type = country_event
	placement = ROOT
	title = nda_ritual.1925.t
	desc = nda_ritual.1925.d
	flavor =  nda_ritual.1925.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect ="event:/SFX/Events/unspecific/devastation"

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds"

	trigger = { 
		is_player = yes
		NOT = { has_global_variable = nda_ritual_completed }
		game_date >= 1925.4.2 # the date the dreams stop	
		NOT = {
			has_global_variable = nda_cthulhu_visits	# run once
		 }

	}

	immediate = {
		set_global_variable = nda_cthulhu_visits	

		debug_log = "Ritual - Stars are not quite right"
	}	
	
	option = { #A Weird Tale
		name = nda_ritual.1925.a
		default_option = yes
	}
}