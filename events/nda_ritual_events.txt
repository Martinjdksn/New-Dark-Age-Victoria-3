namespace = nda_ritual

nda_ritual.1 = { # Cthulhu Returns
	type = country_event
	placement = ROOT
	title = nda_ritual.1.t
	desc = nda_ritual.1.d
	flavor =  nda_ritual.1.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect ="event:/SFX/Events/unspecific/devastation"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = { # limit to eldritch cult ELD ? Called Only?
		has_global_variable = nda_ritual_completed	
		game_date >= 1925.3.23	
		NOT = {
			has_global_variable = nda_cthulhu_arrives	# run once
		 }

	}

	immediate = {
		set_global_variable = nda_cthulhu_arrives	
		nda_effect_cthulhu_arrives = yes
		debug_log = "Ritual - Stars are Right"

		trigger_event = { id = nda_ritual.4 years = 10 } # leaves in 10 years # this is flakey - sometimes does not trigger

		post_notification = nda_ritual_cthulhu_returns # toast
	}	
	
	option = { #So it begins
		name = nda_ritual.1.a
		default_option = yes
	}
}

nda_ritual.2 = { # Cthulhu Early Return
	type = country_event
	placement = ROOT
	title = nda_ritual.2.t
	desc = nda_ritual.2.d
	flavor =  nda_ritual.2.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect ="event:/SFX/Events/unspecific/devastation"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = { # limit to eldritch cult ELD ? Called Only?
		has_global_variable = nda_ritual_completed	
		game_date >= 1890.8.20  # HPL's Birthday
		game_date < 1891 
		NOT = {
			has_global_variable = nda_cthulhu_arrives	# run once
		 }

	}

	immediate = {
		set_global_variable = nda_cthulhu_arrives	
		nda_effect_cthulhu_arrives = yes
		debug_log = "Ritual - Stars are Right Early"

		trigger_event = { id = nda_ritual.4 years = 20 } # leaves in 20 years - longer than normal as reward  # this is flakey - sometimes does not trigger

		post_notification = nda_ritual_cthulhu_returns # toast
	}	
	
	option = { #So it begins
		name = nda_ritual.1.a
		default_option = yes
	}
}

nda_ritual.3 = { # The ritual completed
	type = country_event
	placement = ROOT
	title = nda_ritual.3.t
	desc = nda_ritual.3.d
	flavor =  nda_ritual.3.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = { # Called Only?

	}

	immediate = {
		set_global_variable = nda_ritual_completed	
		debug_log = "Ritual - Completed"	
	}	
	
	option = { # Just a matter of time
		name = nda_ritual.3.a
		default_option = yes
	}
}

nda_ritual.4 = { # Cthulhu Leaves
	type = country_event
	placement = ROOT
	title = nda_ritual.4.t
	desc = nda_ritual.4.d
	flavor =  nda_ritual.4.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = { # Called Only?

	}

	immediate = {
		set_global_variable = nda_ritual_cthulhu_leaves	
		debug_log = "Ritual - Cthulhu Leaves"	

		nda_effect_cthulhu_leaves = yes

		post_notification = nda_ritual_cthulhu_leaves # toast
	}	
	
	option = { # Just a matter of time
		name = nda_ritual.4.a
		default_option = yes
	}
}

nda_ritual.5 = { # The world surrenders. - Boost ELD by auto adding Cult countries on a regular basis
	type = country_event
	placement = ROOT
	title = nda_ritual.5.t
	desc = nda_ritual.5.d
	flavor =  nda_ritual.5.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = { 
		
		# Cthulhu is still here
		has_global_variable = nda_cthulhu_arrives
		NOT = { has_global_variable = nda_ritual_cthulhu_leaves	}
		AND = {
			exists = c:ELD
			c:ELD = ROOT
		}	
		is_player = no # only for AI
		# Has country that can join ELD
		any_country = { 
			is_player = no
			is_country_alive = yes
			NOT = {
				is_full_cult_country = { COUNTRY="THIS" }				
			}
			country_has_primary_culture = cu:nda_cul_cultist
		}

	}

	immediate = {
		# random select country to join ELD
		nda_effect_eldritch_annex = yes

		debug_log = "Ritual - The world surrenders."	

	}	
	
	option = { # Good. Good.
		name = nda_ritual.5.a
		default_option = yes
	}
}

nda_ritual.6 = { # Dismantle Empire - don't think this is really working well - need to dimantle core ELD not just hangers on.
	type = country_event
	placement = ROOT
	title = nda_ritual.6.t
	desc = nda_ritual.6.d
	flavor =  nda_ritual.6.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	trigger = { 
		has_global_variable = nda_ritual_cthulhu_leaves	
		AND = {
			exists = c:ELD
			c:ELD = ROOT
		}	
		is_player = no # only for AI

		# has subject that is not a cultist stronghold
		any_country = {
			is_subject_of = c:ELD
			NOT = { country_has_primary_culture = cu:nda_cul_cultist }
		}
	}

	immediate = {
		
		random_country = {
			limit = {
				is_subject_of = c:ELD	
				#NOT = { country_has_primary_culture = cu:nda_cul_cultist }			
			}

			make_independent = yes

			if = {
				limit = { country_has_primary_culture = cu:nda_cul_cultist }

				remove_primary_culture = cu:nda_cul_cultist
			}
			
			#if = {
			#	limit = { NOT = { is_country_type = decentralized } }
			#	# try for independence
			#	create_diplomatic_play = {
			#		name = nda_cult_liberation
			#		war = yes
			#		type = dp_independence
#
#					target_country = c:ELD
#					#target_state = s:STATE_DELHI.region_state:MUG
#
#					add_war_goal = {
#						holder = c:ELD
#						type = annex_country
#						target_country = THIS
#					}
#				}
#			}
		}
		debug_log = "Ritual - Eldritch Cult Splits"	
		
	}	
	
	option = { # It's Over
		name = nda_ritual.6.a
		default_option = yes
	}
}

# nda_ritual.7 = { # Monitor for Cthulhu departs

# Call of Cthulhu story events
# The Tale of Inspector Legrasse - November 1907 New Orleans
# the American Archeological Society held its annual meeting in St. Louis.
#nda_ritual.1907 = { }
# Animal fury and orgiastic license here whipped themselves to demoniac heights by
# howls and squawking ecstasies that tore and reverberated through those
# nighted woods like pestilential tempests from the gulfs of hell. Now
# and then the less organized ululations would cease, and from what
# seemed a well-drilled chorus of hoarse voices would rise in singsong
#chant that hideous phrase or ritual:
#        "_Ph'nglui mglw'nafh Cthulhu R'lyeh wgah'nagl fhtagn._"

#nda_ritual.1860 = { # Webb expedition to Greenland - recovers idol

#nda_ritual.1925 = { #April - The Vigilant - only if Ritual fails