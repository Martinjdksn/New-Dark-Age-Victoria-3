namespace = nda_nen

	# Arkham = "x2B5499"
    # Innsmouth = "x30C040"
    # Beverly = "xD64964"
    # mine = "xB16D83"
    # Dunwich = "xDB930D" 

# Miskatonic Uni - Library and Herbert West - start events at #10

nda_nen.10 = { # Founding of Library
	type = country_event #state_event
	placement = p:x2B5499 #scope:university_state
	title = nda_nen.10.t
	desc = nda_nen.10.d
	flavor =  nda_nen.10.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/europenorthamerica_art_gallery.bk2"
		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/unspecific/world_fair"

	icon = "gfx/interface/icons/event_icons/tutorial_icon.dds" # book

	trigger = {
 		# 1842 and owner of Miskaton - should still be NEN but could be Neighbours
		game_date >= 1842.6 

		p:x2B5499 = { state = { owner = ROOT } }

		exists = c:NEN
		c:NEN = ROOT

		NOT = { has_global_variable = nda_miskatonic_library }	

		has_technology_researched = academia
	}

	immediate = {
		set_global_variable = nda_miskatonic_library

		p:x2B5499 = { # Arkham
			state = { save_scope_as = university_state }
		}

	}	
	
	option = { #"Accept donations and build Library"
		name = nda_nen.10.a
		default_option = yes
		
		ai_chance = { # should be most likely
			base = 80		
		}

		scope:university_state = {
			# build uni if not existing
			if = {	
				limit = {
					#NOT = {
					#	has_building = building_university
					#}
				}
				create_building={
					building="building_nda_miskatonic_university" #"building_university"
					level=1
					reserves=1
				}
				
			}
			else = {
				# add level to any university??	
				#start_building_construction = building_university
			}

			add_modifier = { # should this be applied via special building for library
				name = nda_miskatonic_uni_modifier
			}

		}
		debug_log = "Build Orne Library"

		#set_variable = nda_miskatonic_library_built # not used yet
	}

	option = { #"Build Statue instead"
		name = nda_nen.10.b

		ai_chance = { # could always do something daft
			base = 20		
		}

		debug_log = "Build Arnold Statue"
		#set_variable = nda_miskatonic_library_unbuilt # use to change chrome text later on chain ?
	}
}

#94140 - Appeal for reinstatement
nda_nen.11 = { # Appeal for reinstatement
	type = country_event
	placement = p:x2B5499
	title = nda_nen.11.t
	desc = nda_nen.11.d
	flavor =  nda_nen.11.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_politicians_arguing.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_scales.dds" # hammer and gavel

	trigger = {
 		# 1903 and owner of Miskatonic Uni - should still be NEN but could be Neighbours
		game_date >= 1903  

		p:x2B5499 = { state = { owner = ROOT has_building = building_nda_miskatonic_university } }

		exists = c:NEN
		c:NEN = ROOT
		has_global_variable = nda_miskatonic_library
		NOT = { has_global_variable = nda_herbert_west_appeal }
		has_technology_researched = academia
	}


	immediate = {
		p:x2B5499 = { # Arkham
			state = { save_scope_as = university_state }
		}
		set_global_variable = nda_herbert_west_appeal
		trigger_event = { id = nda_nen.12 days = 150} # Plague in Arkham		
	}	
	
	option = { #" Of course"
		name = nda_nen.11.a
		default_option = yes

		# main stream herbert
		set_global_variable = herbert_west_approval	


		debug_log = "Herbert West Reinstated"
	}

	option = { #"no we will not"
		name = nda_nen.11.b
		debug_log = "Herbert West Expelled" # End of Story? NO of cource not!

		#trigger_event = { id = nda_nen.12 days = 150} # Plague in Arkham
	}

}

#94141 - Plague in Arkham
nda_nen.12 = { # Plague in Arkham
	type = country_event
	placement = p:x2B5499
	title = nda_nen.12.t
	desc = nda_nen.12.d
	flavor =  nda_nen.12.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_sick_in_hospital.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
 		# from event nda_nen.11 
	}

	immediate = {
		p:x2B5499 = { # Arkham
			state = { save_scope_as = university_state }
		}
	}	
	
	option = { #"Unfortunate Events"
		name = nda_nen.12.a
		default_option = yes
		# nothing to do as info event	

		debug_log = "Arkham Plague"
	}


}
#94142 - Research breakthrough
nda_nen.13 = { # 
	type = country_event
	placement = p:x2B5499
	title = nda_nen.13.t
	desc = nda_nen.13.d
	flavor =  nda_nen.13.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_military_parade.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_default.dds"

	trigger = {
		has_global_variable = herbert_west_approval	
		game_date >= 1918  # 

		p:x2B5499 = { state = { owner = ROOT has_building = building_nda_miskatonic_university } }
		
		exists = c:NEN
		c:NEN = ROOT

		has_technology_researched = chemical_warfare # or other chemical tech??
		NOT = { has_global_variable = herbert_west_successful } # run once
		NOT = { has_global_variable = herbert_west_end } # Can't succeed if dragged to hell by undead!
	}

	immediate = {
		p:x2B5499 = { # Arkham
			state = { save_scope_as = university_state }
		}
	}	
	
	option = { #"We must back this"
		name = nda_nen.13.a
		default_option = yes
		
		# enable decision 'tonic for the troops'
		set_global_variable = herbert_west_successful	


		debug_log = "Herbert West Successful"
	}
	option = { #"Is it too late to stop him?"
		name = nda_nen.13.b
		default_option = yes

		# Do nothing
		debug_log = "Herbert West Stopped"
	}

}


#94143 - Disappearence of Dr West
nda_nen.14 = { # Disappearence of Dr West
	type = country_event
	placement = scope:university_state
	title = nda_nen.14.t
	desc = nda_nen.14.d
	flavor =  nda_nen.14.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_vandalized_storefront.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
		game_date >= 1920  # 
		owns_entire_state_region = STATE_MASSACHUSETTS
		exists = c:NEN
		c:NEN = ROOT
		NOT = { has_global_variable = herbert_west_end }
	}

	immediate = {
		random_scope_state = {
			limit = {
				state_region = s:STATE_MASSACHUSETTS
				owner = ROOT
			}
			save_scope_as = university_state
		}
		set_global_variable = herbert_west_end	
	}	
	
	option = { #" A tragic event"
		name = nda_nen.14.a
		default_option = yes

		debug_log = "Herbert West End"
	}

}


nda_nen.15 = { # End Herbert West with warning from the future - Actually a homage to Clark Ashton Smith
	type = country_event
	placement = ROOT 
	title = nda_nen.15.t
	desc = nda_nen.15.d
	flavor =  nda_nen.15.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_vandalized_storefront.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
		game_date >= 1935  # 
		exists = c:NEN
		c:NEN = ROOT
		has_global_variable = herbert_west_successful
		NOT = { has_variable = herbert_west_future }
	}

	immediate = {
		set_variable = herbert_west_future	
	}	
	
	option = { #" Our Future"
		name = nda_nen.15.a
		default_option = yes

		debug_log = "Herbert West Future"
	}

}

nda_nen.16 = { # A plague of reanimated - End result of 'tonic for the troops' - starts in Miskaton but can spread to neighbours
	type = country_event
	placement = p:x2B5499
	title = nda_nen.16.t
	desc = nda_nen.16.d
	flavor =  nda_nen.16.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_vandalized_storefront.bk2"
		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
		game_date >= 1920 
		exists = c:NEN
		c:NEN = ROOT
		has_global_variable = herbert_west_successful
		has_global_variable = herbert_west_end 
	}

	immediate = {
		p:x2B5499 = { # Arkham
			state = { 
				save_scope_as = university_state 
				# add modifier for plague of reanimated	
				add_modifier = { 
					name = nda_reanimated_state_modifier
				}
			}
		}

		set_global_variable = herbert_west_plague

	}	
	
	option = { #" A tragic event"
		name = nda_nen.14.a
		default_option = yes

		debug_log = "Herbert West End"
	}
}

nda_nen.17 = { # The plague spreads - non visible watcher but fire off event if qualified.
	type = country_event
	hidden = yes
	
	trigger = { 
		has_global_variable = herbert_west_plague
		exists = c:NEN
		c:NEN = ROOT
	}

	immediate = {
		every_country = {
			limit = {
				exists = c:NEN
				c:NEN = ROOT								
			}

			random_scope_state = {
				limit = {
					has_modifier = nda_reanimated_state_modifier 
				}

				random_neighbouring_state = {
					limit = {
						exists = c:NEN
						c:NEN = ROOT	
						NOT = { has_modifier = nda_reanimated_state_modifier }							
					}

					debug_log = "Plague of Reanimated spreads"
					trigger_event = { id = nda_nen.18 }	# fire main event						

				}			
			}
		}		
	}
}

nda_nen.18 = { # The plague of reanimated spreads
	type = state_event
	placement = ROOT
	title = nda_nen.18.t
	desc = nda_nen.18.d
	flavor =  nda_nen.18.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_vandalized_storefront.bk2"
		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	immediate = {
		add_modifier = { 
			name = nda_reanimated_state_modifier
		}
	}	
	
	option = { #" A tragic event"
		name = nda_nen.18.a
		default_option = yes
	}
}

#Shadow over Innsmouth events
nda_nen.20 = { # Devil Worship in Innsmouth
	type = country_event
	placement = p:x30C040 
	title = nda_nen.20.t
	desc = nda_nen.20.d
	flavor =  nda_nen.20.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_vandalized_storefront.bk2"
		
	}
	#event_image = {  texture = "gfx/event_pictures/event1.dds"  }

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
		game_date >= 1845.9 

		p:x30C040 = { state = { owner = ROOT } }

		NOT = { has_global_variable = innsmouth_cult }
	}

	immediate = {
		set_global_variable = innsmouth_cult	
	}	
	
	option = { #"This will not do"
		name = nda_nen.20.a
		default_option = yes

	}

}

nda_nen.21 = { # Plague in Innsmouth

	type = country_event
	placement = p:x30C040 
	title = nda_nen.21.t
	desc = nda_nen.21.d
	flavor =  nda_nen.21.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_vandalized_storefront.bk2"	
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
		game_date >= 1846.3 

		p:x30C040 = { state = { owner = ROOT } }

		NOT = { has_global_variable = innsmouth_plague }
	}

	immediate = {
		set_global_variable = innsmouth_plague	
		# It's not really a Plague - it's the Dagon cult at work on the unbelievers and first gen hybrids leaving to sea.
		p:x30C040 = { 
			state = {
				add_radicals_in_state = {
					value =  medium_radicals
				}
				add_modifier = {
	            	name = plague_modifier
	            	months = 6 # don't over do it
	        	}
			}
		}
	}	
	
	option = { #"Too late to help the poor souls."
		name = nda_nen.21.a
		default_option = yes

	}

}

# if DAG around offer to make Treaty Port of Innsmouth - Y'ha-nthlei - this should be decision??

# nda_nen.22 = { # Choose to raid Innsmouth

# nda_nen.23 = { # The Raid on Innsmouth

nda_nen.1844 = { # Founding of Church of Starry Wisdom - Rhode Island
	type = country_event
	placement = p:x1A77EA 
	title = nda_nen.1844.t
	desc = nda_nen.1844.d
	flavor =  nda_nen.1844.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
		game_date >= 1844.7 # founded july 
		game_date < 1845.4 
		p:x1A77EA = { state = { owner = ROOT } }
	}

	cooldown = { months = 12 }

	immediate = {
	
	}	

	option = { #"A Bizarre Tale.."
		name = nda_nen.1844.a
		default_option = yes
	}
}

nda_nen.1882 = { # The Colour Out Of Space - The Meteor
	type = country_event
	placement = p:xBB7965 
	title = nda_nen.1882.t
	desc = nda_nen.1882.d
	flavor =  nda_nen.1882.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
		game_date >= 1882.6 

		p:xBB7965 = { state = { owner = ROOT } }

		NOT = { has_global_variable = nda_colour_out_of_space }
		# should be Professors from MU?
	}

	immediate = {
		set_global_variable = nda_colour_out_of_space	
	}	
	
	option = { #"A Bizarre Tale.."
		name = nda_nen.1882.a
		default_option = yes

	}
}

nda_nen.1883 = { # The Colour Out Of Space
	type = country_event
	placement = p:xBB7965 
	title = nda_nen.1883.t
	desc = nda_nen.1883.d
	flavor =  nda_nen.1883.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_devastation.bk2"		
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
		game_date >= 1883.3 

		p:xBB7965 = { state = { owner = ROOT } }

		NOT = { has_global_variable = nda_colour_out_of_space_fruit }
		# should be Professors from MU?
	}

	immediate = {
		set_global_variable = nda_colour_out_of_space_fruit	
	}	
	
	option = { #"Pollution?"
		name = nda_nen.1883.a
		default_option = yes

	}
}

nda_nen.1913 = { # Maine Meteor - The Green Meadow
	type = country_event
	placement = p:xD64964 
	title = nda_nen.1913.t
	desc = nda_nen.1913.d
	flavor =  nda_nen.1913.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_whaling.bk2"	
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
		game_date >= 1913.9 

		p:xD64964 = { state = { owner = ROOT } }

		NOT = { has_global_variable = nda_green_meadow }
	}

	immediate = {
		set_global_variable = nda_green_meadow	
		# Based on story The Green Meadow - Ancient Doc found in remains of meteor
	}	
	
	option = { #"A Bizarre Tale.."
		name = nda_nen.1913.a
		default_option = yes

	}
}

nda_nen.1922 = { # Horror at Martin's Beach
	type = country_event
	placement = p:xB04040 
	title = nda_nen.1922.t
	desc = nda_nen.1922.d
	flavor =  nda_nen.1922.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/unspecific_whaling.bk2"	
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/southamerica/war_civilians"

	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	trigger = {
		game_date >= 1922.9 

		p:xB04040 = { state = { owner = ROOT } }

		NOT = { has_global_variable = nda_martins_beach }
	}

	immediate = {
		set_global_variable = nda_martins_beach	
	}	
	
	option = { #"A Bizarre Tale..."
		name = nda_nen.1922.a
		default_option = yes

	}
	option = { #"Hail Dagon..."
		trigger = {
			has_variable = nda_dagon_in_open
		}
		name = nda_nen.1922.b
	}
}

nda_nen.1935 = { # The Outro / denouncement
	type = country_event
	placement = p:x2B5499 
	title = nda_nen.1935.t
	desc = nda_nen.1935.d
	flavor =  nda_nen.1935.f

	duration = 3

	event_image = {
		video = "gfx/event_pictures/europenorthamerica_london_center.bk2"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"
	on_opened_soundeffect = "event:/SFX/Events/europenorthamerica/london_center"

	icon = "gfx/interface/icons/event_icons/event_newspaper.dds" # book

	trigger = {
		game_date >= 1935.10 
		is_player = yes
		p:x2B5499 = { state = { owner = ROOT } }

		NOT = { has_global_variable = nda_outro }
		has_global_variable = nda_ritual_cthulhu_leaves
	}

	immediate = {
		set_global_variable = nda_outro	
	}	
	
	option = { #"Well..."
		name = nda_nen.1935.a
		default_option = yes

	}
}