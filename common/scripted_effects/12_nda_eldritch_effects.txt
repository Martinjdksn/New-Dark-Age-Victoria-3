nda_effect_eldritch_setup = {
		# Set Country Leader as Cultist if not already
		every_scope_character = {
			limit = { 
				is_ruler = yes 
				has_eldritch_trait = no 
			}
			add_trait = nda_master # need to add to heirs as well?
			change_character_religion = rel:nda_rel_cultist
		}

		# set state religion
		set_state_religion = rel:nda_rel_cultist
		
		# set devout to be cultists and to be power brokers
		ig:ig_nda_cult_worshippers = {
			set_interest_group_name = ig_nda_cultist_church
			#remove_ideology = ideology_moralist
			#add_ideology = ideology_nda_cabalistic

			IF = {
				limit = { 
					NOT = { has_modifier = nda_ig_secret_masters_modifier } 
				}
				add_modifier = {
					name = nda_ig_secret_masters_modifier
				}
			}
		}
		
		# set (not so) secret goals and Strategy - need to check for existence
		IF = {
			limit = {
				exists = c:NEN
			}
			set_secret_goal = {
				country = c:NEN
				secret_goal = antagonize
			}			
		}
		IF = {
			limit = {
				exists = c:YIG
			}
			set_secret_goal = {
				country = c:YIG
				secret_goal = protect
			}
		}
		IF = {
			limit = {
				exists = c:DGN
			}
			set_secret_goal = {
				country = c:DGN
				secret_goal = protect
			}			
		}

		set_strategy = ai_strategy_colonial_expansion
		set_strategy = ai_strategy_territorial_expansion
		set_strategy = ai_strategy_conservative_agenda
}

nda_effect_eldritch_annex = {
	# annex a single country that openly supports ELD
	if = {
		limit = {
			exists = ROOT
			ROOT = c:ELD 
			any_country = { 			
				NOT = {
					is_full_cult_country = { COUNTRY="THIS" }	
					is_player = yes	
					any_scope_state = { 
						OR = {
							is_potentially_dagonic = yes
							is_potentially_yigian = yes								
						}						
					}	
					
				}
				has_variable = nda_cultists_in_open
				is_diplomatic_play_committed_participant = no		
			}
		} 

		ordered_country = {
			limit = {
				NOT = {
					is_full_cult_country = { COUNTRY="THIS" }	
					is_player = yes	
					any_scope_state = { 
						OR = {
							is_potentially_dagonic = yes
							is_potentially_yigian = yes								
						}						
					}				
				}
				has_variable = nda_cultists_in_open		
				is_diplomatic_play_committed_participant = no			
			}
			order_by = { subtract = global_country_ranking }
			min = 1	
			max = 3			
			#position = 3 # don't want largest countries just yet

			save_scope_as = nda_eldritch_annex
			
			# Reduce radicals before annex else high revolt risk
			add_radicals  = { value = -0.5 }			
		}

		if = {
			limit = {
				exists = scope:nda_eldritch_annex	
			}	
			
			debug_log = "ELD - Country surrenders."	

			# send notification - does country still exist after annex?
			every_country = {
				post_notification = nda_ritual_country_surrenders
			}

			scope:nda_eldritch_annex = { debug_log_scopes = yes }
			annex = scope:nda_eldritch_annex	
				
		}
		else = {
			debug_log = "ELD - No Country surrenders."	
		}	
	}	
}

nda_effect_eldritch_anger
{
	# The Cult is angry with the target country not following the rite.
	
	every_country = {
		limit = {
			is_full_cult_country = { COUNTRY="THIS" } # any full cult country 			
		}

		change_relations = { country = ROOT value = -100 }

		debug_log = "Angry Cult Country" 
	}
	
	every_country = {
		limit = { # leading cult follower counties
			has_variable = nda_cultists_in_open
			NOT = { is_full_cult_country = { COUNTRY="THIS" } }
		}

		change_relations = { country = ROOT value = -50 }

		debug_log = "Angry Cult Follower Country" 
	}

	#ordered_country = {
	#	limit = { # leading cult follower counties
	#		has_variable = nda_cultists_in_open
	#		NOT = { is_full_cult_country = { COUNTRY="THIS" } }
	#	}
	#	order_by = ??
	#	min = 1
	#	max = 5
	#	check_range_bounds = no
	#
	#	change_relations = { country = ROOT value = -50 }
	#}
}

nda_effect_boost_unification
{

	# try and force DAG creation if not existing
	IF = {
		limit = { 
			NOT = { exists = c:DGN } 
			has_variable = nda_dagon_in_open
		}

		ordered_country = {
			limit = { 
				is_unification_candidate = DGN 
				NOT = { 
						this = ROOT 
				}				
			}
			order_by = { subtract = global_country_ranking }
			max = 1
			change_relations = { country = ROOT value = 200 } # Make friends to assist unification?
		}			
	}

	# try and force YIG creation if not existing
	ELSE_IF = {
		limit = { 
			NOT = { exists = c:YIG } 
			has_variable = nda_yig_in_open
		}

		ordered_country = {
			limit = { 
				is_unification_candidate = YIG 
				NOT = { 
						this = ROOT 
				}				
			}
			order_by = { subtract = global_country_ranking }
			max = 1
			change_relations = { country = ROOT value = 200 } # Make friends to assist unification?
		}			
	}	
	# try and force ELD creation if not existing - do last to give DGN / YIG first boost
	ELSE_IF = {
		limit = { 
			NOT = { exists = c:ELD } 
			has_variable = nda_cultists_in_open
		}

		ordered_country = {
			limit = { 
				is_unification_candidate = ELD 
				NOT = { 
						this = ROOT 
				}				
			}
			order_by = { subtract = global_country_ranking } #order_by = gdp
			max = 1
			change_relations = { country = ROOT value = 200 } # Make friends to assist unification?
			debug_log = "Boost ELD"
		}			
	}
}

nda_effect_eldritch_strife
{
	# The Cult is falling apart after Cthulhu leaves. Cultures are re-asserting themselves
	IF = {
		limit = {
			exists = THIS
			is_full_cult_country = { COUNTRY="THIS" }  			
		}

		random_scope_culture = {
			limit = {
				NOT = { is_primary_culture_of = ROOT }
			}

			save_scope_as = nda_eldritch_rebels
			debug_log_scopes = yes
			ROOT = {
				# convert cultists back to culture in  homeland
				every_scope_state = {
					limit = {
						state_region = {is_homeland = scope:nda_eldritch_rebels	}
					}
					every_scope_pop = {
						limit ={
							OR = {
								has_pop_culture = nda_cul_cultist	
								has_pop_culture = nda_cul_dagonic	
								has_pop_culture = nda_cul_yigian				
							}
						}
						change_pop_culture = { target = scope:nda_eldritch_rebels value = 0.33 }				
					}	
					#every_scope_pop = {
					#	limit ={
					#		has_pop_culture = scope:nda_eldritch_rebels # << Error: has_pop_culture trigger [ Invalid database object 'scope:nda_eldritch_rebels' ]
					#	}
					#	change_pop_religion = { target = rel:nda_rel_cultist value = -0.8 }			
					#}				
				}

				add_loyalists = { value = -0.7 culture = scope:nda_eldritch_rebels }	

				add_radicals = {
					value = 0.7
					culture = scope:nda_eldritch_rebels
				}	
			}
			
			debug_log = "Ritual - Eldritch Cult Rebels"	

			#every_country = { # no need as should lead to secession attempt ?
			#	post_notification = nda_ritual_post_cthulhu_strife
			#}							
		}
	}
}