je_nda_ritual_proceeds = {

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds"

	is_shown_when_inactive = {
		country_has_primary_culture = cu:nda_cul_cultist  
		exists = c:ELD
		c:ELD = ROOT
		NOT = { has_global_variable = nda_ritual_completed  }
	}

	possible = {
	#	# ? has any state as Eldritch homeland - will convert to Yigian on completion
		# just ELD as initiator, DGN after a certain date, Other after a later date - others can assist via second journal
		country_has_primary_culture = cu:nda_cul_cultist # easy check

		custom_tooltip = {
				text = je_nda_ritual_proceeds_possible_tt

				OR = {
					AND = { # ELD should have first chance as initiator
						exists = c:ELD
						c:ELD = ROOT
					}
					AND = { # DGN should have a chance as initiator
						exists = c:DGN
						c:DGN = ROOT
					}
				}

				NOT = { has_global_variable = nda_ritual_completed  }
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_global_variable = je_nda_ritual_proceeds_tracker  } }

			set_global_variable = {
					name = je_nda_ritual_proceeds_tracker
					value = 0
				}
			#clamp_global_variable = {
			#		name = je_nda_ritual_proceeds_tracker
			#		min = 0
			#		max = 5000			
			#}			
		}
		
		save_scope_as = nda_je_ritual_proceeds_scope
		
		debug_log = "Ritual Proceeds Journal : Started : "
	}

    complete = {
		custom_tooltip = {
			text = je_nda_ritual_proceeds_complete_tt
			scope:journal_entry = {
				is_goal_complete = yes
			}
		}
    }

	on_complete = {
		debug_log =  "Ritual Proceeds Journal : Completed :"

		set_global_variable = nda_ritual_completed
		trigger_event = { id = nda_ritual.3 }		
	}

	on_monthly_pulse = {
	
		# need better count up
		effect = {
			scope:nda_je_ritual_proceeds_scope = {
				change_global_variable = {
					name = je_nda_ritual_proceeds_tracker
					add = 10
				}					
			}				
		}		
	}

	current_value = {
		#value = root.var:je_nda_ritual_proceeds_tracker
		value = global_var:je_nda_ritual_proceeds_tracker
	}

	goal_add_value = {
		add = 4000 # 20 years? depending on helpers
	}

    fail = {
		# if ritual failed or star alignment occured
		custom_tooltip = {
			text = je_nda_ritual_time_has_passed_tt
			has_global_variable = nda_cthulhu_visits # Ritual is too late
		}
    }
	
	on_fail = {
		# celebratory event?
	}

	progressbar = yes
	weight = 200

	#inheritable = yes

	should_be_pinned_by_default = yes
}

je_nda_ritual_assist = { # other countries should be able to help - this should be launched via decision??

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds"

	is_shown_when_inactive = {
		OR = {
			country_has_primary_culture = cu:nda_cul_cultist  
			country_has_primary_culture = cu:nda_cul_dagonic
			country_has_primary_culture = cu:nda_cul_yigian
		}

		exists = c:ELD
		NOT = { c:ELD = ROOT }
		NOT = { has_global_variable = nda_ritual_completed  }
	}

	possible = {
	#	# ? has any state as Eldritch homeland 
		OR = { # easy check, but 20+ countries can qualify!
			country_has_primary_culture = cu:nda_cul_cultist  
			country_has_primary_culture = cu:nda_cul_dagonic
			country_has_primary_culture = cu:nda_cul_yigian
		}

		custom_tooltip = {
			text = je_nda_ritual_assist_possible_tt

			has_global_variable = je_nda_ritual_proceeds_tracker
 			NOT = { has_global_variable = nda_ritual_completed  }	
		}
		c:ELD = { relations:root >= relations_threshold:amicable }
	}

	immediate = {
		if = {
			limit = { NOT = { has_global_variable = je_nda_ritual_proceeds_tracker  } }

			set_global_variable = {
					name = je_nda_ritual_proceeds_tracker
					value = 0
				}
			#clamp_global_variable = {
			#		name = je_nda_ritual_proceeds_tracker
			#		min = 0
			#		max = 5000			
			#}			
		}
		
		save_scope_as = nda_je_ritual_proceeds_scope
		
		debug_log = "Ritual Assist Journal : Started : "
	}

    complete = {
		custom_tooltip = {
			text = je_nda_ritual_proceeds_complete_tt
			has_global_variable = nda_ritual_completed  
			#scope:journal_entry = {
			#	is_goal_complete = yes
			#}
		}
    }

	on_complete = {
		debug_log =  "Ritual Assist Journal : Completed :"

		set_global_variable = nda_ritual_completed
		trigger_event = { id = nda_ritual.3 }		
	}

	on_monthly_pulse = {
	
		# need better count up
		effect = {
			scope:nda_je_ritual_proceeds_scope = {
				change_global_variable = {
					name = je_nda_ritual_proceeds_tracker
					add = 1
				}					
			}				
		}		
	}

	current_value = {
		value = global_var:je_nda_ritual_proceeds_tracker
	}

	goal_add_value = {
		add = 4000 # 20 years? depending on helpers
	}

    fail = {
		# if ritual failed or star alignment occured
		# if relations have deteriorated
		OR = {
			custom_tooltip = {
				# If becomes ELD due to original ELD destruction stop assist
				text = je_nda_ritual_assist_fail_is_eld_tt
				ROOT = c:ELD		
			}
			custom_tooltip = {
				text = je_nda_ritual_time_has_passed_tt
				has_global_variable = nda_cthulhu_visits # Ritual is too late
			}
			c:ELD = { relations:root <= relations_threshold:cold }
		}
    }
	
	on_fail = {
		# celebratory event?
	}

	#progressbar = yes
	weight = 200

	#inheritable = yes

	should_be_pinned_by_default = yes
}
