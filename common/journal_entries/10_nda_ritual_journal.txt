je_nda_ritual_proceeds = {

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds"

	is_shown_when_inactive = {
		country_has_primary_culture = cu:nda_cul_cultist  
		exists = c:ELD
		c:ELD = ROOT
		NOT = { has_global_variable = nda_ritual_completed  }
	}

	possible = {
	#	# ? has any state as Eldritch homeland - will convert to Yigian on completion
		# just ELD as initiator, or enable DGN after a certain date, Other after a later date - others can assist via second journal
		country_has_primary_culture = cu:nda_cul_cultist # easy check

		custom_tooltip = {
				text = je_nda_ritual_proceeds_possible_tt

				exists = c:ELD
				c:ELD = ROOT

				NOT = { has_global_variable = nda_ritual_completed  }
				has_global_variable = nda_conjunction_2 # limit to after 1861 if early ELD
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_global_variable = je_nda_ritual_proceeds_tracker  } }

			set_global_variable = {
					name = je_nda_ritual_proceeds_tracker
					value = 0
			}		
		}
		
		# double check - the rename disappeared or was never set so re-assert
		hidden_effect = {
			c:ELD = {
				ig:ig_nda_cult_worshippers = {
					set_interest_group_name = ig_nda_cultist_church

					IF = {
						limit = { 
							NOT = { has_modifier = nda_ig_secret_masters_modifier } 
						}
						add_modifier = {
							name = nda_ig_secret_masters_modifier
						}
					}
				}			
			}			
		}

		save_scope_as = nda_je_ritual_proceeds_scope
		
		debug_log = "Ritual Proceeds Journal : Started : "
	}

    complete = {
		custom_tooltip = {
			text = je_nda_ritual_proceeds_complete_tt
			scope:journal_entry = {
				is_goal_complete = yes
			}
		}
    }

	on_complete = {
		debug_log =  "Ritual Proceeds Journal : Completed :"

		set_global_variable = nda_ritual_completed
		trigger_event = { id = nda_ritual.3 }		
	}

	on_monthly_pulse = {
	
		# need better count up
		effect = {
			scope:nda_je_ritual_proceeds_scope = {
				change_global_variable = {
					name = je_nda_ritual_proceeds_tracker
					add = 10
				}					
			}				
		}		
	}

	current_value = {
		value = global_var:je_nda_ritual_proceeds_tracker
	}

	goal_add_value = {
		add = 5000 # 20 years? depending on helpers and how soon ELD appears
	}

    fail = {
		# if ritual failed or star alignment occured
		custom_tooltip = {
			text = je_nda_ritual_time_has_passed_tt
			has_global_variable = nda_ritual_cthulhu_visits # Ritual is too late
		}
    }
	
	on_fail = {
		# celebratory event?
	}

	progressbar = yes
	weight = 200

	#inheritable = yes

	should_be_pinned_by_default = yes
}

je_nda_ritual_assist = { # other countries should be able to help - this should be launched via decision??

	icon = "gfx/interface/icons/event_icons/event_nda_cthulhu.dds"

	is_shown_when_inactive = {
		has_cult_culture = yes

		exists = c:ELD
		NOT = { c:ELD = ROOT }
		NOT = { has_global_variable = nda_ritual_completed  }
	}

	possible = {
		has_cult_culture = yes

		custom_tooltip = {
			text = je_nda_ritual_assist_possible_tt

			has_global_variable = je_nda_ritual_proceeds_tracker
 			NOT = { has_global_variable = nda_ritual_completed  }	
		}
		c:ELD = { relations:root >= relations_threshold:amicable }
	}

	immediate = {

		save_scope_as = nda_je_ritual_proceeds_scope
		
		debug_log = "Ritual Assist Journal : Started : "
	}

    complete = {
		custom_tooltip = {
			text = je_nda_ritual_proceeds_complete_tt
			has_global_variable = nda_ritual_completed  
		}
    }

	on_complete = {
		debug_log =  "Ritual Assist Journal : Completed :"	
	}

	on_monthly_pulse = {
	
		# need better count up
		effect = {
			scope:nda_je_ritual_proceeds_scope = {
				change_global_variable = {
					name = je_nda_ritual_proceeds_tracker
					add = 1
				}					
			}				
		}		
	}

	current_value = {
		value = global_var:je_nda_ritual_proceeds_tracker
	}

	goal_add_value = {
		add = 5000 # 20 years? depending on helpers
	}

    fail = {
		# if ritual failed or star alignment occured
		# if relations have deteriorated
		OR = {
			custom_tooltip = {
				# If becomes ELD due to original ELD destruction stop assist
				text = je_nda_ritual_assist_fail_is_eld_tt
				ROOT = c:ELD		
			}
			custom_tooltip = {
				text = je_nda_ritual_time_has_passed_tt
				has_global_variable = nda_ritual_cthulhu_visits # Ritual is too late
			}
			c:ELD = { relations:root <= relations_threshold:cold }
		}
    }
	
	on_fail = {
		# celebratory event?
	}

	#progressbar = yes
	weight = 200

	#inheritable = yes

	should_be_pinned_by_default = yes
}
